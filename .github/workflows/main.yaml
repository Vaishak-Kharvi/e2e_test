name: Run Selenium On GitHub Action
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checking out repo
        uses: actions/checkout@v3
      - name: Setting up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Installing package list
        run: apt list --installed

      - name: Check verion/path
        run: |
          google-chrome --version
          chromedriver --version
          readlink -f chromedriver

      - name: Install requirements
        run: |
          pip install -r requirements.txt

      - name: Install Allure
        run: |
          wget -q https://github.com/allure-framework/allure2/releases/download/2.24.1/allure_2.24.1-1_all.deb
          sudo dpkg -i allure_2.24.1-1_all.deb

      - name: Running the Python script
        run: |
          pytest -m test_run -v -s --disable-warnings --alluredir=allure-results
      #          ls
      #          mkdir -p new-folder
      #          cp -r allure-results/* new-folder

      - name: Get Allure history
          uses: actions/checkout@v2
          if: always()
          continue-on-error: true
          with:
            ref: gh-pages
            path: gh-pages

      - name: Generate Report
        run: |
          mkdir -p ./gh-pages
          mkdir -p ./allure-history
          cp -r ./gh-pages/. ./allure-history
          REPO_OWNER_SLASH_NAME=${{ github.repository}}
          echo "$REPO_OWNER_SLASH_NAME"
          REPOSITORY_NAME=${REPO_OWNER_SLASH_NAME##*/}
          echo "$REPOSITORY_NAME"
          GITHUB_PAGES_WEBSITE_URL="https://${{ github.repository_owner }}.github.io/${REPOSITORY_NAME}"
          echo "Github pages url $GITHUB_PAGES_WEBSITE_URL"
          ls
          cd allure-history
          ls
          
#
#      - name: Copy folder to destination
#        run: |
#          git fetch
#          git checkout -f gh-pages
#          cp -r new-folder/* .
#          ls
#          git config user.name github-actions
#          git config user.email github-actions@github.com
#          git add new-folder
#          git commit -m "copied folder to source"
#          git push origin gh-pages
#        env:
#          destination-branch: gh-pages
##
#      - name: Get Allure history
#        uses: actions/checkout@v2
#        if: always()
#        continue-on-error: true
#        with:
#          ref: gh-pages
#          path: gh-pages
#
#      - name: Allure Report action from marketplace
#        uses: simple-elf/allure-report-action@master
#        if: always()
#        id: allure-report
#        with:
#          allure_results: target/allure-results
#          gh_pages: gh-pages
#          allure_report: allure-report
#          allure_history: allure-history
#
#
#      - name: Commit
#        run: |
#          git config --global user.name "GitHub Actions"
#          git config --global user.email "actions@github.com"
#          ls
#          git branch
#          git -b checkout gh-pages
#          ls
#          git status
#          git add .
#          git commit -m "test"
#          git push
#
#      - uses: actions/checkout@v4
#        with:
#          clean: false
#      - run: |
#          git config user.name github-actions
#          git config user.email github-actions@github.com
#          git add ./allure-report
#          git commit -m "generated"
#          git push origin gh-pages --force

#      - name: Setup Pages
#        uses: actions/configure-pages@v2
#      - name: Upload artifact
#        uses: actions/upload-pages-artifact@v1
#        with:
#          # Upload entire repository
#          path: ./allure-report
#      - name: Deploy to GitHub Pages
#        id: deployment
#        uses: actions/deploy-pages@v1
#
#      - name: Deploy report to Github Pages
#        if: always()
#        uses: peaceiris/actions-gh-pages@v2
#        env:
#          PERSONAL_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#          PUBLISH_BRANCH: gh-pages
#          PUBLISH_DIR: allure-history
